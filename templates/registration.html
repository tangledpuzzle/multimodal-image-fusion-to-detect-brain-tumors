{% extends 'base.html' %}

{% block link %}
<link rel="stylesheet" href="{{ url_for('static',filename='css/registration.css') }}">
{% endblock %}

{% block script %}
<script type="text/javascript" src="{{ url_for('static',filename='js/coords.js') }}"></script>
{% endblock %}

{% block body %}
<script type="text/javascript">
var mriCoord = [];
function FindPosition(oElement)
{
    console.log("In FindPos");
    if(typeof( oElement.offsetParent ) != "undefined")
    {
    for(var posX = 0, posY = 0; oElement; oElement = oElement.offsetParent)
    {
        posX += oElement.offsetLeft;
        posY += oElement.offsetTop;
    }
        return [ posX, posY ];
    }
    else
    {
        return [ oElement.x, oElement.y ];
    }
}

function ChangeColour(PosX, PosY, myImg){
    console.log("In Change Colour");
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');
    var img = document.getElementById('mri');
    // canvas.width = img.width;
    // canvas.height = img.height;
    context.drawImage(img, 0, 0 );
    var imgData = context.getImageData(0, 0, img.width, img.height);

    var i;
    for (i = 0; i < imgData.data.length; i += 4) {
    imgData.data[i] = 255-imgData.data[i];
    imgData.data[i + 1] = 255-imgData.data[i + 1];
    imgData.data[i + 2] = 255-imgData.data[i + 2];
    imgData.data[i + 3] = 255;
    }
    console.log(imgData);
    // imgData.data[0]=255;
    // imgData.data[1]=0;
    // imgData.data[2]=0;
    // imgData.data[3]=255;
}

function GetCoordinates(e){
    ChangeColour(0,0,myImg);
    console.log("In GETCOORD");
    console.log(myImg)  
    var PosX = 0;
    var PosY = 0;
    var ImgPos;
    ImgPos = FindPosition(myImg);
    if (!e) var e = window.event;
    if (e.pageX || e.pageY)
    {
    PosX = e.pageX;
    PosY = e.pageY;
    }
    else if (e.clientX || e.clientY)
    {
        PosX = e.clientX + document.body.scrollLeft
        + document.documentElement.scrollLeft;
        PosY = e.clientY + document.body.scrollTop
        + document.documentElement.scrollTop;
    }
    PosX = PosX - ImgPos[0];
    PosY = PosY - ImgPos[1];
    document.getElementById("x").innerHTML = PosX;
    document.getElementById("y").innerHTML = PosY;

    // var imgObj=document.getElementById("mri");
    // console.log(imgObj);
    ChangeColour(PosX, PosY, myImg);
}
</script>
<div class="content">
    <div class="heading">
        <div style="margin-left:120px; margin-right: 250px;">MRI Image</div>
        <div>CT Image</div>
    </div>
    <canvas id="myCanvas" height="350" width="350"></canvas>
    <img src="{{ url_for('static',filename='mri.jpg') }}" id="mri" alt="MRI" height="350" width="350" class="mri" style="display:none;">
    <script type="text/javascript">
        
        var myImg = document.getElementById("myCanvas");
        console.log("Hi");
        console.log(myImg);
        myImg.onclick = GetCoordinates;
        
    </script>
        
    <p>X:<span id="x"></span></p>
    <p>Y:<span id="y"></span></p>

    <img src="{{ url_for('static',filename='ct.jpg') }}" id="ct" alt="CT" height="350" width="350" class="ct">
</div>
{% endblock %}